generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String
  role      String  @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  companies Company[]
  documents Document[]
  shares    Share[]

  @@map("users")
}

model Company {
  id        Int     @id @default(autoincrement())
  name      String
  edrpou    String  @unique
  director  String
  accountant String
  phone     String
  email     String
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  documents Document[]
  shares    Share[]

  @@map("companies")
}

model Document {
  id        Int     @id @default(autoincrement())
  name      String
  category  String  @default("personal")
  fileUrl   String
  fileName  String
  fileSize  Int
  mimeType  String
  content   String? @db.Text
  companyId Int
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  shares    Share[]

  @@map("documents")
}

model Share {
  id        Int     @id @default(autoincrement())
  token     String  @unique
  type      String
  documentId Int?
  companyId Int?
  userId    Int
  targetEmail String?
  expiresAt DateTime
  password  String?
  accessCount Int @default(0)
  createdAt DateTime @default(now())

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  document  Document?  @relation(fields: [documentId], references: [id], onDelete: Cascade)
  company   Company?   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("shares")
}
